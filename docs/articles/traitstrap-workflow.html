<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>traitstrap-workflow • traitstrap</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="traitstrap-workflow">
<meta property="og:description" content="traitstrap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">traitstrap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.901</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/traitstrap-workflow.html">traitstrap-workflow</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/richardjtelford/traitstrap/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="traitstrap-workflow_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>traitstrap-workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/richardjtelford/traitstrap/blob/master/vignettes/traitstrap-workflow.Rmd"><code>vignettes/traitstrap-workflow.Rmd</code></a></small>
      <div class="hidden name"><code>traitstrap-workflow.Rmd</code></div>

    </div>

    
    
<!-- fig.align = 'right',  -->
<p><img src="Traitstrap_hex.png" width="15%" style="float:right; padding:8px"></p>
<p>This vignette explains how to use the traitstrap package (Telford et al). For more details on the methods see Maitner et al.</p>
<p>First of all, relax and turn on some music. We have prepared the <a href="https://tinyurl.com/traitstrap">traitstrap playlist</a> for you!</p>
<div id="the-aim-of-traitstrap" class="section level2">
<h2 class="hasAnchor">
<a href="#the-aim-of-traitstrap" class="anchor"></a>The aim of traitstrap</h2>
<p>Trait distributions can be used to infer the importance of community assembly processes and the role of climate drivers in shaping species and community responses to climate change. Community ecology has typically focused on the <strong>mean</strong>, however the <strong>higher moments</strong> (variance, skewness, and kurtosis) of trait distributions can reveal information about the various processes shaping species diversity.</p>
<p><img src="true-dist.png" width="90%"></p>
<p>Measuring trait distributions is often difficult and time-consuming as it requires information on measuring trait values of all individuals present. Sampling protocols often limit sampling to a non-representative subset of the community, or rely upon species-level average traits values calculated in other locations or across many locations.</p>
<p>Traditionally the moments of trait distributions have been estimated using weighting approaches that rely on the average traits of species weighted by some measure of abundance within the community. Such <strong>community-weighted</strong> trait moments methods assume that a species’ trait expression can be adequately represented by the mean, ignoring intraspecific trait variation.</p>
<p>To more accurately estimate local trait distributions, trait sampling should thus occur both across multiple individuals within each species, and across multiple locations or experimental treatments across the extent of the study in order to capture both inter- and intra-specific variability.</p>
<p><img src="comm-boot.png" width="90%"></p>
<p><strong>Traitstrap</strong> is an <strong>R package</strong> to estimate the moments of community trait distributions using a <strong>bootstrapping approach</strong>. Further, this package uses a hierarchical sampling design, which allows accounting for incomplete trait collections, traits from different spatial or temporal levels (e.g. local traits vs. databases), taxonomic hierarchies (e.g., species vs genus) and experimental designs (e.g., multiple sites, or treated vs. control sampling units).</p>
<p>The package has three <strong>main functions</strong>:</p>
<ul>
<li>
<strong>trait imputation</strong> function which allows to account for intraspecific trait variation and hierarchical sampling design.</li>
<li>a resample method using <strong>bootstrapping</strong> (parametric or nonparametric method) to calculate community weighted mean and happy moments (variance, skewness and kurtosis).</li>
<li>a <strong>summary function</strong> that summarizes the trait moments and calculates confidence intervals.</li>
</ul>
<p>Note that for this tutorial we are calling the mean and the higher moments the happy moments :-)</p>
</div>
<div id="the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#the-data" class="anchor"></a>The data</h2>
<p>For this vignette we will use part of a vascular plant dataset from two sites near Longyearbyen on Svalbard. The data was collected during the Plant Functional Trait Course in 2018 and contains data on the plant community composition and functional traits. For more details see this <a href="https://github.com/Plant-Functional-Trait-Course/PFTC_4_Svalbard">GitHub repo</a></p>
<p>Note that some of the species names have been adapted.</p>
</div>
<div id="organize-your-data" class="section level2">
<h2 class="hasAnchor">
<a href="#organize-your-data" class="anchor"></a>Organize your data</h2>
<p>To run traitstrap two datasets are required:</p>
<ul>
<li>one dataset with information on abundance (e.g. biomass, size, cover, etc.) of the community, which is used to weight species traits by abundance in the community.</li>
<li>one dataset with the traits for each species (or as many species and individuals you have data for) in your community.</li>
</ul>
<p>The datasets need to be organized in a <strong>tidy</strong> and <strong>long</strong> format and certain columns (see below) are required, but the naming of these columns are up to the user.</p>
<p>Let us have a look at these datasets in an example.</p>
<p>The <strong>community data</strong> should have information the abundance of species in the community. This dataset will be used to weigh the traits by species abundance. Note that abundance can also be cover, size, biomass, or something similar.</p>
<p>In this example the contains species names (e.g. <strong>Taxon</strong>), cover of each species per plot (e.g. <strong>Cover</strong>) and two columns with information about the <strong>hierarchy</strong> (i.e. <strong>Site</strong> and <strong>PlotID</strong>).</p>
<pre><code>#&gt; # A tibble: 110 x 4
#&gt;    Taxon             Cover Site  PlotID
#&gt;    &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
#&gt;  1 alopecurus ovatus   0.5 1     B     
#&gt;  2 alopecurus ovatus   1   1     C     
#&gt;  3 alopecurus ovatus   1   1     D     
#&gt;  4 alopecurus ovatus   2   1     F     
#&gt;  5 alopecurus ovatus   0.1 1     G     
#&gt;  6 bistorta vigdis    10   1     A     
#&gt;  7 bistorta vigdis    25   1     B     
#&gt;  8 bistorta vigdis    10   1     C     
#&gt;  9 bistorta vigdis     2   1     D     
#&gt; 10 bistorta vigdis     1   1     F     
#&gt; # … with 100 more rows</code></pre>
<p>The <strong>trait data</strong> should contain information about traits and trait values for as many species and individuals in the community data as possible. The data should be organized in the same way as the community data and should have corresponding columns. In this example the trait data contains <strong>Taxon</strong>, <strong>Site</strong> and <strong>PlotID</strong> as well as <strong>Trait</strong> and <strong>Value</strong>.</p>
<pre><code>#&gt; # A tibble: 749 x 5
#&gt;    Taxon                   Site  PlotID Trait         Value
#&gt;    &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;
#&gt;  1 saxifraga oppositifolia 1     A      Wet_Mass_g 0.000695
#&gt;  2 bistorta vigdis         1     C      Wet_Mass_g 0.0105  
#&gt;  3 festuca rubra           2     C      Wet_Mass_g 0.00724 
#&gt;  4 bistorta vigdis         1     C      Wet_Mass_g 0.0189  
#&gt;  5 equisetum arvense       1     E      Wet_Mass_g 0.270   
#&gt;  6 bistorta vigdis         1     B      Wet_Mass_g 0.0231  
#&gt;  7 luzula confusa          1     F      Wet_Mass_g 0.0135  
#&gt;  8 alopecurus ovatus       1     G      Wet_Mass_g 0.0234  
#&gt;  9 alopecurus ovatus       1     G      Wet_Mass_g 0.0300  
#&gt; 10 alopecurus ovatus       1     C      Wet_Mass_g 0.0267  
#&gt; # … with 739 more rows</code></pre>
</div>
<div id="trait-imputation" class="section level2">
<h2 class="hasAnchor">
<a href="#trait-imputation" class="anchor"></a>Trait imputation</h2>
<p>The <code>trait_impute</code> function uses a hierarchical sampling design, which allows to account for incomplete trait collections, traits from different spatial or temporal levels (i.e. local traits vs. databases), different taxonomic resolution and/or experimental design.</p>
<p>The first two mandatory arguments in the function are the two datasets: <code>comm</code> and <code>traits</code></p>
<p>The next four arguments are also mandatory and refer to specific columns in the trait or community dataset:</p>
<ul>
<li>
<code>abundance</code> which is the abundance of your species in your community dataset. This can be abundance, cover, biomass, or size, etc.</li>
<li>
<code>taxon_col</code> is the column in your community and trait data that define the species.</li>
<li>
<code>trait_col</code> is the column in your trait data that defines the traits.</li>
<li>
<code>value_col</code> is the column in your trait data that defines the trait values.</li>
</ul>
<p>All the other arguments are not mandatory.</p>
<p>With <code>scale_hierarchy</code> you can define the levels at which the traits have been collected and the order of trait imputation starting with the highest level (e.g. global database, regional, site, plot). In the example below we have the levels <strong>Site</strong> and <strong>PlotID</strong>, starting with the highest level.</p>
<p>The <code>trait_impute</code> function will choose if available a trait value from the lowest level, i.e. species X from plot A in site 1. If no trait value is available from that level (plot A, site 1), it will other groups in the same level and choose a trait value from species X from plot B or C at site 1. If there is no trait available, it will move up the hierarchy to the next level and choose trait values from species X from other sites (site 2, 3, etc.).</p>
<p>The argument <code>min_n_in_samples</code> allows users to define the minimum number in samples that are chosen at each level. If the minimum number is not reached (i.e. there are only 3 trait values at a specific level), trait values from the next higher level will be imputed, to avoid sampling the same individual several times, which could result in unrealistic variances. The default minimum number of samples is 5.</p>
<p>In the <code>other_col</code> argument other grouping variables in the community dataset can be defined and will be kept after the trait imputation.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">trait_imputation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_impute.html">trait_impute</a></span><span class="op">(</span>
    <span class="co"># input data (mandatory)</span>
    comm <span class="op">=</span> <span class="va">community</span>,
    traits <span class="op">=</span> <span class="va">trait</span>,
    
    <span class="co"># specifies columns in your data (mandatory)</span>
    abundance_col <span class="op">=</span> <span class="st">"Cover"</span>,
    taxon_col <span class="op">=</span> <span class="st">"Taxon"</span>,
    trait_col <span class="op">=</span> <span class="st">"Trait"</span>,
    value_col <span class="op">=</span> <span class="st">"Value"</span>,
    
    <span class="co"># specifies sampling hierarchy</span>
    scale_hierarchy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Site"</span>, <span class="st">"PlotID"</span><span class="op">)</span>,
    
    <span class="co"># min number of samples</span>
    min_n_in_sample <span class="op">=</span> <span class="fl">9</span>
  <span class="op">)</span>

<span class="va">trait_imputation</span>
<span class="co">#&gt; # A tibble: 4,007 x 12</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait [28]</span>
<span class="co">#&gt;    Taxon Cover Site  PlotID global sum_abun Trait   Value n_sample weight level</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;int&gt;  &lt;dbl&gt; &lt;ord&gt;</span>
<span class="co">#&gt;  1 fest…     1 1     A      global     38.2 Wet_… 0.00724       11 0.0909 glob…</span>
<span class="co">#&gt;  2 fest…     1 1     A      global     38.2 Wet_… 0.0160        11 0.0909 glob…</span>
<span class="co">#&gt;  3 fest…     1 1     A      global     38.2 Wet_… 0.00529       11 0.0909 glob…</span>
<span class="co">#&gt;  4 fest…     1 1     A      global     38.2 Wet_… 0.0154        11 0.0909 glob…</span>
<span class="co">#&gt;  5 fest…     1 1     A      global     38.2 Wet_… 0.0066        11 0.0909 glob…</span>
<span class="co">#&gt;  6 fest…     1 1     A      global     38.2 Wet_… 0.00637       11 0.0909 glob…</span>
<span class="co">#&gt;  7 fest…     1 1     A      global     38.2 Wet_… 0.00491       11 0.0909 glob…</span>
<span class="co">#&gt;  8 fest…     1 1     A      global     38.2 Wet_… 0.0132        11 0.0909 glob…</span>
<span class="co">#&gt;  9 fest…     1 1     A      global     38.2 Wet_… 0.0233        11 0.0909 glob…</span>
<span class="co">#&gt; 10 fest…     1 1     A      global     38.2 Wet_… 0.0115        11 0.0909 glob…</span>
<span class="co">#&gt; # … with 3,997 more rows, and 1 more variable: max_n_in_sample &lt;int&gt;</span></code></pre></div>
<p>Traitstrap also allows to include taxonomy and experimental design in the trait imputation step.</p>
<p>With the argument <code>taxon_col</code> the taxonomic hierarchy for sampling can be defined. This means if traits for a specific species are not available, trait values from the same genus will be imputed. For this a list of the taxonomic hierarchy has to be defined (e.g. “Taxon”, “Genus”). Note that traits from species of the same genus can have very different traits and it might not be meaningful to impute these traits. Therefore, you should always check the trait distributions for the same genus before using taxonomic trait imputation.</p>
<p>The argument <code>treatment_col</code> allows to incorporate an experimental design where traits are imputed from the same experimental treatment or the first factor level, which is assumed to be the control. Therefore, it is important to order the levels of a treatment in the right order, i.e. the first level has to be the control. The imputation step can be defined at certain level using the <code>treatment_level</code> argument. Depending on the experimental design it might make sense to impute traits at a certain level, e.g. block or site.</p>
<p>Here is an example how to include taxonomy and experimental design in the trait imputation function (code not run).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>trait_imputation2 <span class="ot">&lt;-</span> <span class="fu">trait_impute</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">comm =</span> community,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">traits =</span> trait,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">abundance_col =</span> <span class="st">"Cover"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># defining taxonomic hierarchy</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">taxon_col =</span> <span class="fu">c</span>(<span class="st">"Taxon"</span>, <span class="st">"Genus"</span>),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">trait_col =</span> <span class="st">"Trait"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_col =</span> <span class="st">"Value"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale_hierarchy =</span> <span class="fu">c</span>(<span class="st">"Site"</span>, <span class="st">"PlotID"</span>),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_n_in_sample =</span> <span class="dv">3</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># specifying experimental design</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_col =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_level =</span> <span class="st">"Site"</span>,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="nonparametric-bootstrapping" class="section level2">
<h2 class="hasAnchor">
<a href="#nonparametric-bootstrapping" class="anchor"></a>Nonparametric bootstrapping</h2>
<p>The output of the trait imputation function is then used to do a <strong>nonparametric bootstrapping</strong> using the <code>trait_np_bootstrap</code> function.</p>
<p>Nonparametric bootstrapping is a resampling method to estimate the trait moments. The traits are re-sampled in proportion to their weight in the community (e.g. by the abundance of the species).</p>
<p>The trait values across all individuals in a community are resampled n times (<code>sample_size</code>; the default is 200) to incorporate the full spectrum of trait variation, generating n number (<code>nrep</code>; the default is 100) of trait distributions.</p>
<p>From these trait distributions the happy moments are estimated: <strong>mean</strong>, <strong>variance</strong>, <strong>skewness</strong> and <strong>kurtosis</strong>.</p>
<p>This function also allows to extract raw distributions by setting the argument <code>raw = TRUE</code>. The raw data can be useful for visualizing the trait distributions. If the raw data is extracted, <code>nrep</code> is forced to 1 to avoid memory issues.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># run nonparametric bootstrapping</span>
<span class="va">np_bootstrapped_moments</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_np_bootstrap.html">trait_np_bootstrap</a></span><span class="op">(</span>
  <span class="va">trait_imputation</span>, 
  nrep <span class="op">=</span> <span class="fl">200</span>
  <span class="op">)</span>

<span class="va">np_bootstrapped_moments</span>
<span class="co">#&gt; # A tibble: 5,600 x 9</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID [14]</span>
<span class="co">#&gt;    n     global Site  PlotID Trait             mean   variance skewness kurtosis</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     global 1     A      Plant_Height_cm 1.50    1.97         3.35    14.3  </span>
<span class="co">#&gt;  2 1     global 1     A      Wet_Mass_g      0.0119  0.0000518    0.700    0.606</span>
<span class="co">#&gt;  3 1     global 1     B      Plant_Height_cm 1.92    3.69         2.37     5.86 </span>
<span class="co">#&gt;  4 1     global 1     B      Wet_Mass_g      0.0125  0.0000619    2.11     8.57 </span>
<span class="co">#&gt;  5 1     global 1     C      Plant_Height_cm 1.70    2.14         2.60     7.95 </span>
<span class="co">#&gt;  6 1     global 1     C      Wet_Mass_g      0.0151  0.0000597    1.20     2.08 </span>
<span class="co">#&gt;  7 1     global 1     D      Plant_Height_cm 2.01    4.88         2.23     4.67 </span>
<span class="co">#&gt;  8 1     global 1     D      Wet_Mass_g      0.0125  0.0000497    1.57     3.98 </span>
<span class="co">#&gt;  9 1     global 1     E      Plant_Height_cm 7.03   19.3          0.316   -0.661</span>
<span class="co">#&gt; 10 1     global 1     E      Wet_Mass_g      0.0145  0.000224     3.08     9.56 </span>
<span class="co">#&gt; # … with 5,590 more rows</span></code></pre></div>
<p>One advantage of using a bootstrapping approach, is that we get much more than a mean trait value. We can also estimate the variance and other moments of these trait distributions. In traitstrap happy moments can be summarized and the confidence intervals calculated using the <code>trait_summarise_boot_moments</code> function. The input variable for this function is the output from the nonparametric bootstrapping function (or the parametric bootstrapping function, see below).</p>
<p>The confidence interval can be calculated parametrically, using the mean and standard deviation, or nonparametrically using quantiles. The default is using the mean and standard deviation (<code>parametric = TRUE</code>) with one standard deviation around each trait moment (<code>sd_mult = 1</code>). For the nonparametric approach the default is a 0.95 confidence level.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># summarizes bootstrapping output</span>
<span class="va">sum_boot_moment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_summarise_boot_moments.html">trait_summarise_boot_moments</a></span><span class="op">(</span>
  <span class="va">np_bootstrapped_moments</span>
  <span class="op">)</span>

<span class="va">sum_boot_moment</span>
<span class="co">#&gt; # A tibble: 28 x 17</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID [14]</span>
<span class="co">#&gt;    global Site  PlotID Trait     n   mean ci_low_mean ci_high_mean     var</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 global 1     A      Plan…   200 1.72        1.61         1.84   2.69e+0</span>
<span class="co">#&gt;  2 global 1     A      Wet_…   200 0.0121      0.0115       0.0126 6.56e-5</span>
<span class="co">#&gt;  3 global 1     B      Plan…   200 1.76        1.64         1.88   2.62e+0</span>
<span class="co">#&gt;  4 global 1     B      Wet_…   200 0.0136      0.0130       0.0142 6.89e-5</span>
<span class="co">#&gt;  5 global 1     C      Plan…   200 1.73        1.63         1.83   1.86e+0</span>
<span class="co">#&gt;  6 global 1     C      Wet_…   200 0.0149      0.0141       0.0157 1.24e-4</span>
<span class="co">#&gt;  7 global 1     D      Plan…   200 1.87        1.71         2.02   4.65e+0</span>
<span class="co">#&gt;  8 global 1     D      Wet_…   200 0.0117      0.0112       0.0122 4.82e-5</span>
<span class="co">#&gt;  9 global 1     E      Plan…   200 7.08        6.78         7.38   1.71e+1</span>
<span class="co">#&gt; 10 global 1     E      Wet_…   200 0.0162      0.0150       0.0174 2.73e-4</span>
<span class="co">#&gt; # … with 18 more rows, and 8 more variables: ci_low_var &lt;dbl&gt;,</span>
<span class="co">#&gt; #   ci_high_var &lt;dbl&gt;, skew &lt;dbl&gt;, ci_low_skew &lt;dbl&gt;, ci_high_skew &lt;dbl&gt;,</span>
<span class="co">#&gt; #   kurt &lt;dbl&gt;, ci_low_kurt &lt;dbl&gt;, ci_high_kurt &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="parametric-bootstrapping" class="section level2">
<h2 class="hasAnchor">
<a href="#parametric-bootstrapping" class="anchor"></a>Parametric bootstrapping</h2>
<p>Traitstrap also offers the option to run a <strong>parametric bootstrapping</strong>.</p>
<p>The <code>trait_fit_distributions</code> function fits parametric distributions for each species-by-trait combination at the finest scale of the user-supplied hierarchy. This function takes as input:</p>
<ul>
<li>an object of class imputed traits (as produced by the function <code>trait_impute</code>), and</li>
<li>the type of distribution to be fitted.</li>
</ul>
<p>Either a single distribution type can be used for all traits, or traits can be assigned specific distributions types by supplying the function with a named list of traits (e.g. <code><a href="https://rdrr.io/r/base/list.html">list(height = "normal", mass = "lognormal")</a></code>).</p>
<p>Currently the function supports normal, log-normal, and beta (values between 0 and 1) distributions.</p>
<p>The function returns a dataframe containing fitted distribution parameters.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># fit distributions</span>
<span class="va">fitted_distributions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_fit_distributions.html">trait_fit_distributions</a></span><span class="op">(</span>
  imputed_traits <span class="op">=</span> <span class="va">trait_imputation</span>,
  distribution_type <span class="op">=</span> <span class="st">"lognormal"</span>
  <span class="op">)</span>
<span class="co">#&gt; Warning in .data[["Trait"]] == names(distribution_type)[distribution_type == :</span>
<span class="co">#&gt; longer object length is not a multiple of shorter object length</span>

<span class="va">fitted_distributions</span>
<span class="co">#&gt; # A tibble: 202 x 15</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait, Taxon, Cover, n_sample [202]</span>
<span class="co">#&gt;    global Site  PlotID Trait Taxon Cover n_sample distribution_ty…  parm1 parm2</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;    &lt;int&gt; &lt;fct&gt;             &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 global 1     A      Plan… bist…  10         28 lognormal         0.328 0.517</span>
<span class="co">#&gt;  2 global 1     A      Plan… drya…   0.1        9 lognormal         1.04  0.704</span>
<span class="co">#&gt;  3 global 1     A      Plan… fest…   1         11 lognormal         1.61  0.377</span>
<span class="co">#&gt;  4 global 1     A      Plan… luzu…   0.5       15 lognormal         1.50  0.325</span>
<span class="co">#&gt;  5 global 1     A      Plan… luzu…   1         20 lognormal         0.588 0.459</span>
<span class="co">#&gt;  6 global 1     A      Plan… sali…  20         44 lognormal        -0.138 0.931</span>
<span class="co">#&gt;  7 global 1     A      Plan… saxi…   2          6 lognormal         1.13  0.469</span>
<span class="co">#&gt;  8 global 1     A      Plan… saxi…   2          2 lognormal         0.693 0    </span>
<span class="co">#&gt;  9 global 1     A      Plan… sile…   1          3 lognormal        -0.221 0.277</span>
<span class="co">#&gt; 10 global 1     A      Wet_… bist…  10         29 lognormal        -4.06  0.454</span>
<span class="co">#&gt; # … with 192 more rows, and 5 more variables: sd1 &lt;lgl&gt;, sd2 &lt;lgl&gt;, ks &lt;dbl&gt;,</span>
<span class="co">#&gt; #   cvm &lt;dbl&gt;, ad &lt;dbl&gt;</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># fit several types of distributions</span>
<span class="va">fitted_distributions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_fit_distributions.html">trait_fit_distributions</a></span><span class="op">(</span>
  imputed_traits <span class="op">=</span> <span class="va">trait_imputation</span>,
  distribution_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Plant_Height_cm <span class="op">=</span> <span class="st">"normal"</span>, Wet_Mass_g <span class="op">=</span> <span class="st">"lognormal"</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">fitted_distributions</span></code></pre></div>
<p>The <code>trait_parametric_bootstrap</code> function is a parametric analogue of the <code>trait_np_bootstrap</code> function. It takes in fitted trait distributions produced by <code>trait_fit_distributions</code> and randomly samples from among the fitted distributions proportionally to species abundances in the community.</p>
<p>As with <code>trait_np_bootstrap</code>, the number of samples per replicated draw are specified with the parameter <code>sample_size</code>, and the number of replicated draws is specified by the parameter <code>nrep.</code> The argument <code>raw</code> allows to extract raw distributions (see above).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># run parametric bootstrapping</span>
<span class="va">p_bootstrapped_moments</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_parametric_bootstrap.html">trait_parametric_bootstrap</a></span><span class="op">(</span>
    fitted_distributions <span class="op">=</span> <span class="va">fitted_distributions</span>, 
    nrep <span class="op">=</span> <span class="fl">200</span>
    <span class="op">)</span>

<span class="va">p_bootstrapped_moments</span>
<span class="co">#&gt; # A tibble: 5,600 x 9</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait [28]</span>
<span class="co">#&gt;    n     global Site  PlotID Trait             mean   variance skewness kurtosis</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     global 1     A      Plant_Height_cm 1.64    1.68         1.82     4.90 </span>
<span class="co">#&gt;  2 1     global 1     A      Wet_Mass_g      0.0128  0.0000647    1.48     4.08 </span>
<span class="co">#&gt;  3 1     global 1     B      Plant_Height_cm 1.80    2.80         1.58     2.35 </span>
<span class="co">#&gt;  4 1     global 1     B      Wet_Mass_g      0.0136  0.0000552    1.16     1.54 </span>
<span class="co">#&gt;  5 1     global 1     C      Plant_Height_cm 1.62    1.87         3.78    18.7  </span>
<span class="co">#&gt;  6 1     global 1     C      Wet_Mass_g      0.0145  0.0000758    2.53    10.3  </span>
<span class="co">#&gt;  7 1     global 1     D      Plant_Height_cm 1.61    2.82         1.86     3.20 </span>
<span class="co">#&gt;  8 1     global 1     D      Wet_Mass_g      0.0120  0.0000744    3.08    15.0  </span>
<span class="co">#&gt;  9 1     global 1     E      Plant_Height_cm 6.92   18.6          0.539    0.131</span>
<span class="co">#&gt; 10 1     global 1     E      Wet_Mass_g      0.0165  0.000331     2.63     7.37 </span>
<span class="co">#&gt; # … with 5,590 more rows</span></code></pre></div>
<p>The output of trait_parametric_bootstrap can be summarized using <code>trait_summarize_boot_moments</code> (see above).</p>
</div>
<div id="extracting-raw-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-raw-distributions" class="anchor"></a>Extracting raw distributions</h2>
<p>In traitstrap both the parametric and nonparametric bootstrapping functions allow returning raw trait distributions.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># run nonparametric bootstrapping</span>
<span class="va">raw_dist_np</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_np_bootstrap.html">trait_np_bootstrap</a></span><span class="op">(</span>
  <span class="va">trait_imputation</span>,
  raw <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="va">raw_dist_np</span>
<span class="co">#&gt; # A tibble: 5,600 x 13</span>
<span class="co">#&gt; # Groups:   global, Site, PlotID, Trait [28]</span>
<span class="co">#&gt;    n     Taxon Cover Site  PlotID global sum_abun Trait Value n_sample weight</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;    &lt;int&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     sali…  20   1     A      global     38.2 Plan…   0.3       44 0.455 </span>
<span class="co">#&gt;  2 1     sile…   1   1     A      global     38.2 Plan…   1          3 0.333 </span>
<span class="co">#&gt;  3 1     bist…  10   1     A      global     38.2 Plan…   1         28 0.357 </span>
<span class="co">#&gt;  4 1     luzu…   0.5 1     A      global     38.2 Plan…   4.3       15 0.0333</span>
<span class="co">#&gt;  5 1     sali…  20   1     A      global     38.2 Plan…   1.3       44 0.455 </span>
<span class="co">#&gt;  6 1     sali…  20   1     A      global     38.2 Plan…   0.8       44 0.455 </span>
<span class="co">#&gt;  7 1     sali…  20   1     A      global     38.2 Plan…   1.3       44 0.455 </span>
<span class="co">#&gt;  8 1     sali…  20   1     A      global     38.2 Plan…   1.5       44 0.455 </span>
<span class="co">#&gt;  9 1     bist…  10   1     A      global     38.2 Plan…   1.5       28 0.357 </span>
<span class="co">#&gt; 10 1     sali…  20   1     A      global     38.2 Plan…   0.5       44 0.455 </span>
<span class="co">#&gt; # … with 5,590 more rows, and 2 more variables: level &lt;ord&gt;,</span>
<span class="co">#&gt; #   max_n_in_sample &lt;int&gt;</span></code></pre></div>
<p>The raw data can be useful for visualizing the trait distributions.</p>
<p>Use colour and facets to separate between the different traits, hierarchies and treatments.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">raw_dist_np</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">Site</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>end <span class="op">=</span> <span class="fl">0.9</span>, option <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log(trait value)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">Trait</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code></pre></div>
<p><img src="traitstrap-workflow_files/figure-html/plot-raw-dist-np-1.png" width="576"></p>
</div>
<div id="check-your-data" class="section level2">
<h2 class="hasAnchor">
<a href="#check-your-data" class="anchor"></a>Check your data</h2>
<p>Traitstrap has a couple of functions to check the data.</p>
<p>The <code>coverage_plot</code> function shows the trait coverage of the community for each level. Basically, this function summarizes from which level the traits are imputed, and how much coverage of the community is reached.</p>
<p>Based on simulations, we recommend to collect traits for at least 80% of the community cover (Maitner et al. in prep).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># show coverage plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">trait_imputation</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="traitstrap-workflow_files/figure-html/coverage-plot-1.png" width="576"></p>
<p>Another important information is to know of which taxa traits are missing. This can be useful if the data sampling is not finished and you want to know which species should be sampled. The function also tells you the maximal abundance of each missing species, and gives you useful information if the missing species are abundant or rare.</p>
<p>Traitstrap has a function <code>trait_missing</code> which gives you a table with all missing values.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># list missing traits</span>
<span class="fu"><a href="../reference/trait_missing.html">trait_missing</a></span><span class="op">(</span>imputed_trait <span class="op">=</span> <span class="va">trait_imputation</span>,
              comm <span class="op">=</span> <span class="va">community</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 20 x 3</span>
<span class="co">#&gt; # Groups:   Taxon [20]</span>
<span class="co">#&gt;    Taxon                      max_abun n_traits</span>
<span class="co">#&gt;    &lt;chr&gt;                         &lt;dbl&gt;    &lt;int&gt;</span>
<span class="co">#&gt;  1 alopecurus ovatus               2          2</span>
<span class="co">#&gt;  2 bistorta vigdis                25          2</span>
<span class="co">#&gt;  3 calamagrostis neglecta         60          2</span>
<span class="co">#&gt;  4 cassiope tetragona              5          2</span>
<span class="co">#&gt;  5 dryas octopetala               20          2</span>
<span class="co">#&gt;  6 enquistetum scirpoides          2          2</span>
<span class="co">#&gt;  7 festuca rubra                   1          2</span>
<span class="co">#&gt;  8 juncus biglumis                 0.5        1</span>
<span class="co">#&gt;  9 luzula confusa                  5          2</span>
<span class="co">#&gt; 10 luzula nivalis                  5          2</span>
<span class="co">#&gt; 11 maitneranthes hieracifolia      0.5        1</span>
<span class="co">#&gt; 12 oxyria tanyna                   2          2</span>
<span class="co">#&gt; 13 poa pratensis                   1          2</span>
<span class="co">#&gt; 14 salix polaris                  43          2</span>
<span class="co">#&gt; 15 saxifraga hirculus              2          2</span>
<span class="co">#&gt; 16 saxifraga oppositifolia         2          2</span>
<span class="co">#&gt; 17 silene acaudis                  1          2</span>
<span class="co">#&gt; 18 stelfordaria humifusa           0.5        1</span>
<span class="co">#&gt; 19 stellaria longipes              0.1        1</span>
<span class="co">#&gt; 20 trisetum spicatum               3          2</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Richard J. Telford, Aud Halbritter, Brian S. Maitner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
