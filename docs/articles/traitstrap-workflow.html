<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>traitstrap-workflow • traitstrap</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="traitstrap-workflow">
<meta property="og:description" content="traitstrap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">traitstrap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.903</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/traitstrap-workflow.html">traitstrap-workflow</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Plant-Functional-Trait-Course/traitstrap/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>traitstrap-workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Plant-Functional-Trait-Course/traitstrap/blob/HEAD/vignettes/traitstrap-workflow.Rmd" class="external-link"><code>vignettes/traitstrap-workflow.Rmd</code></a></small>
      <div class="hidden name"><code>traitstrap-workflow.Rmd</code></div>

    </div>

    
    
<!-- fig.align = 'right',  -->
<p><img src="../reference/figures/Traitstrap_hex.png" width="15%" style="float:right; padding:8px"></p>
<p>This vignette explains how to use the traitstrap package (Telford et
al). For more details on the methods see Maitner et al.</p>
<p>First of all, relax and turn on some music. We have prepared the <a href="https://tinyurl.com/traitstrap" class="external-link">traitstrap playlist</a> for
you!</p>
<div class="section level2">
<h2 id="the-aim-of-traitstrap">The aim of traitstrap<a class="anchor" aria-label="anchor" href="#the-aim-of-traitstrap"></a>
</h2>
<p>Trait distributions can be used to infer the importance of community
assembly processes and the role of climate drivers in shaping species
and community responses to climate change. Community ecology has
typically focused on the <strong>mean</strong>, however the
<strong>higher moments</strong> (variance, skewness, and kurtosis) of
trait distributions can reveal information about the various processes
shaping species diversity.</p>
<p><img src="true-dist.png" width="90%"></p>
<p>Measuring trait distributions is often difficult and time-consuming
as it requires information on measuring trait values of all individuals
present. Sampling protocols often limit sampling to a non-representative
subset of the community, or rely upon species-level average traits
values calculated in other locations or across many locations.</p>
<p>Traditionally the moments of trait distributions have been estimated
using weighting approaches that rely on the average traits of species
weighted by some measure of abundance within the community. Such
<strong>community-weighted</strong> trait moments methods assume that a
species’ trait expression can be adequately represented by the mean,
ignoring intraspecific trait variation.</p>
<p>To more accurately estimate local trait distributions, trait sampling
should thus occur both across multiple individuals within each species,
and across multiple locations or experimental treatments across the
extent of the study in order to capture both inter- and intra-specific
variability.</p>
<p><img src="comm-boot.png" width="90%"></p>
<p><strong>Traitstrap</strong> is an <strong>R package</strong> to
estimate the moments of community trait distributions using a
<strong>bootstrapping approach</strong>. Further, this package uses a
hierarchical sampling design, which allows accounting for incomplete
trait collections, traits from different spatial or temporal levels
(e.g. local traits vs. databases), taxonomic hierarchies (e.g., species
vs genus) and experimental designs (e.g., multiple sites, or treated
vs. control sampling units).</p>
<p>The package has three <strong>main functions</strong>:</p>
<ul>
<li>
<strong>trait filling</strong> function which allows to account for
intraspecific trait variation and hierarchical sampling design.</li>
<li>a resample method using <strong>bootstrapping</strong> (parametric
or nonparametric method) to calculate community weighted mean and happy
moments (variance, skewness and kurtosis).</li>
<li>a <strong>summary function</strong> that summarizes the trait
moments and calculates confidence intervals.</li>
</ul>
<p>Note that for this tutorial we are calling the mean and the higher
moments the happy moments :-)</p>
</div>
<div class="section level2">
<h2 id="the-data">The data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h2>
<p>For this vignette we will use part of a vascular plant dataset from
two sites near Longyearbyen on Svalbard. The data was collected during
the Plant Functional Trait Course in 2018 and contains data on the plant
community composition and functional traits. For more details see this
<a href="https://github.com/Plant-Functional-Trait-Course/PFTC_4_Svalbard" class="external-link">GitHub
repo</a></p>
<p>Note that some of the species names have been adapted.</p>
</div>
<div class="section level2">
<h2 id="organize-your-data">Organize your data<a class="anchor" aria-label="anchor" href="#organize-your-data"></a>
</h2>
<p>To run traitstrap two datasets are required:</p>
<ul>
<li>one dataset with information on abundance (e.g. biomass, size,
cover, etc.) of the community, which is used to weight species traits by
abundance in the community.</li>
<li>one dataset with the traits for each species (or as many species and
individuals you have data for) in your community.</li>
</ul>
<p>The datasets need to be organized in a <strong>tidy</strong> and
<strong>long</strong> format and certain columns (see below) are
required, but the naming of these columns are up to the user.</p>
<p>Let us have a look at these datasets in an example.</p>
<p>The <strong>community data</strong> should have information the
abundance of species in the community. This dataset will be used to
weigh the traits by species abundance. Note that abundance can also be
cover, size, biomass, or something similar.</p>
<p>In this example the contains species names
(e.g. <strong>Taxon</strong>), cover of each species per plot
(e.g. <strong>Cover</strong>) and two columns with information about the
<strong>hierarchy</strong> (i.e. <strong>Site</strong> and
<strong>PlotID</strong>).</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 110 × 4</span></span></span>
<span><span class="co">#&gt;    Taxon             Cover Site  PlotID</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> alopecurus ovatus   0.5 1     B     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> alopecurus ovatus   1   1     C     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> alopecurus ovatus   1   1     D     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> alopecurus ovatus   2   1     F     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> alopecurus ovatus   0.1 1     G     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> bistorta vigdis    10   1     A     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> bistorta vigdis    25   1     B     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> bistorta vigdis    10   1     C     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> bistorta vigdis     2   1     D     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> bistorta vigdis     1   1     F     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 100 more rows</span></span></span></code></pre>
<p>The <strong>trait data</strong> should contain information about
traits and trait values for as many species and individuals in the
community data as possible. The data should be organized in the same way
as the community data and should have corresponding columns. In this
example the trait data contains <strong>Taxon</strong>,
<strong>Site</strong> and <strong>PlotID</strong> as well as
<strong>Trait</strong> and <strong>Value</strong>.</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 705 × 6</span></span></span>
<span><span class="co">#&gt;    Site  PlotID Taxon                   ID      Trait              Value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1     A      saxifraga oppositifolia ANF4320 Plant_Height_cm 2       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1     A      saxifraga oppositifolia ANF4320 Wet_Mass_g      0.000<span style="text-decoration: underline;">695</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1     A      saxifraga oppositifolia ANF4320 Thickness_mm    0.127   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1     C      bistorta vigdis         ARQ4344 Plant_Height_cm 4.2     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1     C      bistorta vigdis         ARQ4344 Wet_Mass_g      0.010<span style="text-decoration: underline;">5</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1     C      bistorta vigdis         ARQ4344 Thickness_mm    0.154   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2     C      festuca rubra           AMT1545 Plant_Height_cm 7       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2     C      festuca rubra           AMT1545 Wet_Mass_g      0.007<span style="text-decoration: underline;">24</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2     C      festuca rubra           AMT1545 Thickness_mm    0.257   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1     C      bistorta vigdis         ARP2422 Plant_Height_cm 1       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 695 more rows</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="trait-filling">Trait filling<a class="anchor" aria-label="anchor" href="#trait-filling"></a>
</h2>
<p>The <code><a href="../reference/trait_fill.html">trait_fill()</a></code> function uses a hierarchical sampling
design, which allows to account for incomplete trait collections, traits
from different spatial or temporal levels (i.e. local traits
vs. databases), different taxonomic resolution and/or experimental
design.</p>
<p>The first two mandatory arguments in the function are the two
datasets: <code>comm</code> and <code>traits</code></p>
<p>The next four arguments are also mandatory and refer to specific
columns in the trait or community dataset:</p>
<ul>
<li>
<code>abundance</code> which is the abundance of your species in
your community dataset. This can be abundance, cover, biomass, or size,
etc.</li>
<li>
<code>taxon_col</code> is the column in your community and trait
data that define the species.</li>
<li>
<code>trait_col</code> is the column in your trait data that defines
the traits.</li>
<li>
<code>value_col</code> is the column in your trait data that defines
the trait values.</li>
</ul>
<p>All the other arguments are not mandatory.</p>
<p>With <code>scale_hierarchy</code> you can define the levels at which
the traits have been collected and the order of trait filling starting
with the highest level (e.g. global database, regional, site, plot). In
the example below we have the levels <strong>Site</strong> and
<strong>PlotID</strong>, starting with the highest level.</p>
<p>The <code><a href="../reference/trait_fill.html">trait_fill()</a></code> function will choose if available a
trait value from the lowest level, i.e. species X from plot A in site 1.
If no trait value is available from that level (plot A, site 1), it will
other groups in the same level and choose a trait value from species X
from plot B or C at site 1. If there is no trait available, it will move
up the hierarchy to the next level and choose trait values from species
X from other sites (site 2, 3, etc.).</p>
<p>The argument <code>min_n_in_samples</code> allows users to define the
minimum number in samples that are chosen at each level. If the minimum
number is not reached (i.e. there are only 3 trait values at a specific
level), trait values from the next higher level will be filled, to avoid
sampling the same individual several times, which could result in
unrealistic variances. The default minimum number of samples is 5.</p>
<p>In the <code>other_col</code> argument other grouping variables in
the community dataset can be defined and will be kept after the trait
filling.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trait_filling</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_fill.html">trait_fill</a></span><span class="op">(</span></span>
<span>  <span class="co"># input data (mandatory)</span></span>
<span>  comm <span class="op">=</span> <span class="va">community</span>,</span>
<span>  traits <span class="op">=</span> <span class="va">trait</span>,</span>
<span></span>
<span>  <span class="co"># specifies columns in your data (mandatory)</span></span>
<span>  abundance_col <span class="op">=</span> <span class="st">"Cover"</span>,</span>
<span>  taxon_col <span class="op">=</span> <span class="st">"Taxon"</span>,</span>
<span>  trait_col <span class="op">=</span> <span class="st">"Trait"</span>,</span>
<span>  value_col <span class="op">=</span> <span class="st">"Value"</span>,</span>
<span></span>
<span>  <span class="co"># specifies sampling hierarchy</span></span>
<span>  scale_hierarchy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Site"</span>, <span class="st">"PlotID"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="co"># min number of samples</span></span>
<span>  min_n_in_sample <span class="op">=</span> <span class="fl">9</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">trait_filling</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,011 × 13</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   global, Site, PlotID, Trait [42]</span></span></span>
<span><span class="co">#&gt;    Taxon     Cover Site  PlotID global sum_a…¹ ID    Trait Value n_sam…²  weight</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> dryas oc…   0.1 1     A      global    38.2 ATC4… Plan…   1.3      17 0.005<span style="text-decoration: underline;">88</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> dryas oc…   0.1 1     A      global    38.2 ADC9… Plan…   1.4      17 0.005<span style="text-decoration: underline;">88</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> dryas oc…   0.1 1     A      global    38.2 AVU2… Plan…   1.5      17 0.005<span style="text-decoration: underline;">88</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> dryas oc…   0.1 1     A      global    38.2 AHU1… Plan…   2        17 0.005<span style="text-decoration: underline;">88</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> dryas oc…   0.1 1     A      global    38.2 AHS4… Plan…   2.5      17 0.005<span style="text-decoration: underline;">88</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> dryas oc…   0.1 1     A      global    38.2 AHR0… Plan…   2.4      17 0.005<span style="text-decoration: underline;">88</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> dryas oc…   0.1 1     A      global    38.2 ABE6… Plan…   0.6      17 0.005<span style="text-decoration: underline;">88</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> dryas oc…   0.1 1     A      global    38.2 BUP1… Plan…   2.2      17 0.005<span style="text-decoration: underline;">88</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> dryas oc…   0.1 1     A      global    38.2 ADE9… Plan…   1        17 0.005<span style="text-decoration: underline;">88</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> dryas oc…   0.1 1     A      global    38.2 ACH6… Plan…   3        17 0.005<span style="text-decoration: underline;">88</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 4,001 more rows, 2 more variables: level &lt;ord&gt;, max_n_in_sample &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   and abbreviated variable names ¹​sum_abun, ²​n_sample</span></span></span></code></pre></div>
<p>Traitstrap also allows to include taxonomy and experimental design in
the trait filling step.</p>
<p>With the argument <code>taxon_col</code> the taxonomic hierarchy for
sampling can be defined. This means if traits for a specific species are
not available, trait values from the same genus will be used. For this a
list of the taxonomic hierarchy has to be defined (e.g. “Taxon”,
“Genus”). Note that traits from species of the same genus can have very
different traits and it might not be meaningful to use these traits.
Therefore, you should always check the trait distributions for the same
genus before using taxonomic trait filling.</p>
<p>The argument <code>treatment_col</code> allows to incorporate an
experimental design where traits are filled from the same experimental
treatment or the first factor level, which is assumed to be the control.
Therefore, it is important to order the levels of a treatment in the
right order, i.e. the first level has to be the control. The filling
step can be defined at certain level using the
<code>treatment_level</code> argument. Depending on the experimental
design it might make sense to fill traits at a certain level, e.g. block
or site.</p>
<p>Here is an example how to include taxonomy and experimental design in
the trait filling function (code not run).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trait_filling2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_fill.html">trait_fill</a></span><span class="op">(</span></span>
<span>  comm <span class="op">=</span> <span class="va">community</span>,</span>
<span>  traits <span class="op">=</span> <span class="va">trait</span>,</span>
<span>  abundance_col <span class="op">=</span> <span class="st">"Cover"</span>,</span>
<span></span>
<span>  <span class="co"># defining taxonomic hierarchy</span></span>
<span>  taxon_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Taxon"</span>, <span class="st">"Genus"</span><span class="op">)</span>,</span>
<span>  trait_col <span class="op">=</span> <span class="st">"Trait"</span>,</span>
<span>  value_col <span class="op">=</span> <span class="st">"Value"</span>,</span>
<span>  scale_hierarchy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Site"</span>, <span class="st">"PlotID"</span><span class="op">)</span>,</span>
<span>  min_n_in_sample <span class="op">=</span> <span class="fl">3</span>,</span>
<span></span>
<span>  <span class="co"># specifying experimental design</span></span>
<span>  treatment_col <span class="op">=</span> <span class="st">"Treatment"</span>,</span>
<span>  treatment_level <span class="op">=</span> <span class="st">"Site"</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="nonparametric-bootstrapping">Nonparametric bootstrapping<a class="anchor" aria-label="anchor" href="#nonparametric-bootstrapping"></a>
</h2>
<p>The output of the trait filling function is then used to do a
<strong>nonparametric bootstrapping</strong> using the
<code><a href="../reference/trait_np_bootstrap.html">trait_np_bootstrap()</a></code> function.</p>
<p>Nonparametric bootstrapping is a resampling method to estimate the
trait moments. The traits are re-sampled in proportion to their weight
in the community (e.g. by the abundance of the species).</p>
<p>The trait values across all individuals in a community are resampled
n times (<code>sample_size</code>; the default is 200) to incorporate
the full spectrum of trait variation, generating n number
(<code>nrep</code>; the default is 100) of trait distributions.</p>
<p>From these trait distributions the happy moments are estimated:
<strong>mean</strong>, <strong>variance</strong>,
<strong>skewness</strong> and <strong>kurtosis</strong>.</p>
<p>This function also allows to extract raw distributions by setting the
argument <code>raw = TRUE</code>. The raw data can be useful for
visualizing the trait distributions. If the raw data is extracted,
<code>nrep</code> is forced to 1 to avoid memory issues.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run nonparametric bootstrapping</span></span>
<span><span class="va">np_bootstrapped_moments</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_np_bootstrap.html">trait_np_bootstrap</a></span><span class="op">(</span></span>
<span>  <span class="va">trait_filling</span>,</span>
<span>  nrep <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">np_bootstrapped_moments</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8,400 × 8</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   global, Site, PlotID [14]</span></span></span>
<span><span class="co">#&gt;    global Site  PlotID Trait             mean  variance skewness kurtosis</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> global 1     A      Plant_Height_cm 1.5    2.52        3.25     12.3  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> global 1     A      Thickness_mm    0.221  0.003<span style="text-decoration: underline;">77</span>     1.19      1.55 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> global 1     A      Wet_Mass_g      0.011<span style="text-decoration: underline;">1</span> 0.000<span style="text-decoration: underline;">056</span>7   0.554    -<span style="color: #BB0000;">1.07</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> global 1     B      Plant_Height_cm 1.53   2.49        3.13     11.8  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> global 1     B      Thickness_mm    0.198  0.001<span style="text-decoration: underline;">64</span>    -<span style="color: #BB0000;">0.017</span><span style="color: #BB0000; text-decoration: underline;">5</span>   -<span style="color: #BB0000;">0.602</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> global 1     B      Wet_Mass_g      0.011<span style="text-decoration: underline;">7</span> 0.000<span style="text-decoration: underline;">046</span>5   0.537    -<span style="color: #BB0000;">1.04</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> global 1     C      Plant_Height_cm 1.68   4.18        2.82      7.85 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> global 1     C      Thickness_mm    0.207  0.003<span style="text-decoration: underline;">05</span>     2.28     12.3  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> global 1     C      Wet_Mass_g      0.012<span style="text-decoration: underline;">1</span> 0.000<span style="text-decoration: underline;">117</span>    3.90     21.7  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> global 1     D      Plant_Height_cm 1.75   5.18        3.14     11.3  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 8,390 more rows</span></span></span></code></pre></div>
<p>One advantage of using a bootstrapping approach, is that we get much
more than a mean trait value. We can also estimate the variance and
other moments of these trait distributions. In traitstrap happy moments
can be summarized and the confidence intervals calculated using the
<code><a href="../reference/trait_summarise_boot_moments.html">trait_summarise_boot_moments()</a></code> function. The input variable
for this function is the output from the nonparametric bootstrapping
function (or the parametric bootstrapping function, see below).</p>
<p>The confidence interval can be calculated parametrically, using the
mean and standard deviation, or nonparametrically using quantiles. The
default is using the mean and standard deviation
(<code>parametric = TRUE</code>) with one standard deviation around each
trait moment (<code>sd_mult = 1</code>). For the nonparametric approach
the default is a 0.95 confidence level.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># summarizes bootstrapping output</span></span>
<span><span class="va">sum_boot_moment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_summarise_boot_moments.html">trait_summarise_boot_moments</a></span><span class="op">(</span></span>
<span>  <span class="va">np_bootstrapped_moments</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sum_boot_moment</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 42 × 17</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   global, Site, PlotID [14]</span></span></span>
<span><span class="co">#&gt;    global Site  PlotID Trait            n   mean ci_lo…¹ ci_hi…²     var ci_lo…³</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> global 1     A      Plant_Heigh…   200 1.62    1.49    1.75   3.24<span style="color: #949494;">e</span>+0 2.44<span style="color: #949494;">e</span>+0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> global 1     A      Thickness_mm   200 0.214   0.209   0.218  3.46<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 2.95<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> global 1     A      Wet_Mass_g     200 0.010<span style="text-decoration: underline;">9</span>  0.010<span style="text-decoration: underline;">4</span>  0.011<span style="text-decoration: underline;">3</span> 4.85<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span> 4.46<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> global 1     B      Plant_Heigh…   200 1.61    1.49    1.73   3.09<span style="color: #949494;">e</span>+0 2.36<span style="color: #949494;">e</span>+0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> global 1     B      Thickness_mm   200 0.203   0.200   0.206  1.68<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 1.54<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> global 1     B      Wet_Mass_g     200 0.012<span style="text-decoration: underline;">2</span>  0.011<span style="text-decoration: underline;">7</span>  0.012<span style="text-decoration: underline;">7</span> 4.61<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span> 4.29<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> global 1     C      Plant_Heigh…   200 1.69    1.55    1.84   3.93<span style="color: #949494;">e</span>+0 3.01<span style="color: #949494;">e</span>+0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> global 1     C      Thickness_mm   200 0.205   0.201   0.209  2.80<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 2.02<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> global 1     C      Wet_Mass_g     200 0.011<span style="text-decoration: underline;">7</span>  0.011<span style="text-decoration: underline;">0</span>  0.012<span style="text-decoration: underline;">4</span> 1.11<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span> 4.90<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> global 1     D      Plant_Heigh…   200 1.83    1.65    2.01   5.82<span style="color: #949494;">e</span>+0 4.59<span style="color: #949494;">e</span>+0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 32 more rows, 7 more variables: ci_high_var &lt;dbl&gt;, skew &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ci_low_skew &lt;dbl&gt;, ci_high_skew &lt;dbl&gt;, kurt &lt;dbl&gt;, ci_low_kurt &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ci_high_kurt &lt;dbl&gt;, and abbreviated variable names ¹​ci_low_mean,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ²​ci_high_mean, ³​ci_low_var</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parametric-bootstrapping">Parametric bootstrapping<a class="anchor" aria-label="anchor" href="#parametric-bootstrapping"></a>
</h2>
<p>Traitstrap also offers the option to run a <strong>parametric
bootstrapping</strong>.</p>
<p>The <code><a href="../reference/trait_fit_distributions.html">trait_fit_distributions()</a></code> function fits parametric
distributions for each species-by-trait combination at the finest scale
of the user-supplied hierarchy. This function takes as input:</p>
<ul>
<li>an object of class filled traits (as produced by the function
<code>trait_fill</code>), and</li>
<li>the type of distribution to be fitted.</li>
</ul>
<p>Either a single distribution type can be used for all traits, or
traits can be assigned specific distributions types by supplying the
function with a named list of traits
(e.g. <code>list(height = "normal", mass = "lognormal")</code>).</p>
<p>Currently the function supports normal, log-normal, and beta (values
between 0 and 1) distributions.</p>
<p>The function returns a dataframe containing fitted distribution
parameters.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit distributions</span></span>
<span><span class="va">fitted_distributions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_fit_distributions.html">trait_fit_distributions</a></span><span class="op">(</span></span>
<span>  filled_traits <span class="op">=</span> <span class="va">trait_filling</span>,</span>
<span>  distribution_type <span class="op">=</span> <span class="st">"lognormal"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were 604 warnings in `summarize()`.</span></span>
<span><span class="co">#&gt; The first warning was:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `quiet(get_dist_parms(data = .data[["Value"]], distribution_type</span></span>
<span><span class="co">#&gt;   = unique(distribution_type)))`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 1: `global = "global"`, `Site = "1"`, `PlotID = "A"`, `Trait =</span></span>
<span><span class="co">#&gt;   "Plant_Height_cm"`, `Taxon = "bistorta vigdis"`, `Cover = 10`, `n_sample =</span></span>
<span><span class="co">#&gt;   17`.</span></span>
<span><span class="co">#&gt; Caused by warning in `dlnorm()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> NaNs produced</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 603 remaining warnings.</span></span>
<span></span>
<span><span class="va">fitted_distributions</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 303 × 15</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   global, Site, PlotID, Trait, Taxon, Cover, n_sample [303]</span></span></span>
<span><span class="co">#&gt;    global Site  PlotID Trait      Taxon Cover n_sam…¹ distr…²  parm1 parm2 sd1  </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> global 1     A      Plant_Hei… bist…  10        17 lognor…  0.156 0.587 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> global 1     A      Plant_Hei… drya…   0.1      17 lognor…  0.434 0.810 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> global 1     A      Plant_Hei… fest…   1        11 lognor…  1.61  0.377 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> global 1     A      Plant_Hei… luzu…   0.5      10 lognor…  1.45  0.287 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> global 1     A      Plant_Hei… luzu…   1        14 lognor…  0.405 0.501 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> global 1     A      Plant_Hei… sali…  20        22 lognor… -<span style="color: #BB0000;">0.320</span> 1.08  <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> global 1     A      Plant_Hei… saxi…   2         6 lognor…  1.13  0.469 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> global 1     A      Plant_Hei… saxi…   2         2 lognor…  0.693 0     <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> global 1     A      Plant_Hei… sile…   1         3 lognor… -<span style="color: #BB0000;">0.221</span> 0.277 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> global 1     A      Thickness… bist…  10        17 lognor… -<span style="color: #BB0000;">1.55</span>  0.194 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 293 more rows, 4 more variables: sd2 &lt;lgl&gt;, ks &lt;dbl&gt;, cvm &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ad &lt;dbl&gt;, and abbreviated variable names ¹​n_sample, ²​distribution_type</span></span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit several types of distributions</span></span>
<span><span class="va">fitted_distributions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_fit_distributions.html">trait_fit_distributions</a></span><span class="op">(</span></span>
<span>  filled_traits <span class="op">=</span> <span class="va">trait_filling</span>,</span>
<span>  distribution_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Plant_Height_cm <span class="op">=</span> <span class="st">"normal"</span>, Wet_Mass_g <span class="op">=</span> <span class="st">"lognormal"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fitted_distributions</span></span></code></pre></div>
<p>The <code><a href="../reference/trait_parametric_bootstrap.html">trait_parametric_bootstrap()</a></code> function is a
parametric analogue of the <code><a href="../reference/trait_np_bootstrap.html">trait_np_bootstrap()</a></code> function.
It takes in fitted trait distributions produced by
<code>trait_fit_distributions</code> and randomly samples from among the
fitted distributions proportionally to species abundances in the
community.</p>
<p>As with <code><a href="../reference/trait_np_bootstrap.html">trait_np_bootstrap()</a></code>, the number of samples per
replicated draw are specified with the parameter
<code>sample_size</code>, and the number of replicated draws is
specified by the parameter <code>nrep.</code> The argument
<code>raw</code> allows to extract raw distributions (see above).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run parametric bootstrapping</span></span>
<span><span class="va">p_bootstrapped_moments</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_parametric_bootstrap.html">trait_parametric_bootstrap</a></span><span class="op">(</span></span>
<span>  fitted_distributions <span class="op">=</span> <span class="va">fitted_distributions</span>,</span>
<span>  nrep <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_bootstrapped_moments</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8,400 × 8</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   global, Site, PlotID, Trait [42]</span></span></span>
<span><span class="co">#&gt;    global Site  PlotID Trait             mean  variance skewness kurtosis</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> global 1     A      Plant_Height_cm 1.75   3.99         3.99   26.1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> global 1     A      Thickness_mm    0.212  0.004<span style="text-decoration: underline;">02</span>      2.52    9.57  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> global 1     A      Wet_Mass_g      0.010<span style="text-decoration: underline;">7</span> 0.000<span style="text-decoration: underline;">051</span>7    1.10    1.32  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> global 1     B      Plant_Height_cm 1.63   3.08         2.39    7.94  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> global 1     B      Thickness_mm    0.199  0.001<span style="text-decoration: underline;">71</span>      0.526  -<span style="color: #BB0000;">0.013</span><span style="color: #BB0000; text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> global 1     B      Wet_Mass_g      0.011<span style="text-decoration: underline;">8</span> 0.000<span style="text-decoration: underline;">046</span>1    1.32    2.75  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> global 1     C      Plant_Height_cm 1.86   3.82         2.71   11.4   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> global 1     C      Thickness_mm    0.203  0.002<span style="text-decoration: underline;">23</span>      2.18    9.48  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> global 1     C      Wet_Mass_g      0.011<span style="text-decoration: underline;">0</span> 0.000<span style="text-decoration: underline;">045</span>7    1.83    5.66  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> global 1     D      Plant_Height_cm 1.88   7.73         4.47   28.8   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 8,390 more rows</span></span></span></code></pre></div>
<p>The output of trait_parametric_bootstrap can be summarized using
<code>trait_summarize_boot_moments()</code> (see above).</p>
</div>
<div class="section level2">
<h2 id="extracting-raw-distributions">Extracting raw distributions<a class="anchor" aria-label="anchor" href="#extracting-raw-distributions"></a>
</h2>
<p>In traitstrap both the parametric and nonparametric bootstrapping
functions allow returning raw trait distributions.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run nonparametric bootstrapping</span></span>
<span><span class="va">raw_dist_np</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_np_bootstrap.html">trait_np_bootstrap</a></span><span class="op">(</span></span>
<span>  selected_traits <span class="op">=</span> <span class="va">trait_filling</span>,</span>
<span>  raw <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">raw_dist_np</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8,400 × 13</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   global, Site, PlotID, Trait [42]</span></span></span>
<span><span class="co">#&gt;    Taxon      Cover Site  PlotID global sum_a…¹ ID    Trait Value n_sam…² weight</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> salix pol…    20 1     A      global    38.2 AQT8… Plan…   0.3      22 0.909 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> salix pol…    20 1     A      global    38.2 BRL7… Plan…   1.3      22 0.909 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> luzula ni…     1 1     A      global    38.2 BUX4… Plan…   1.8      14 0.071<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> salix pol…    20 1     A      global    38.2 BRN7… Plan…   1        22 0.909 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> silene ac…     1 1     A      global    38.2 AUD1… Plan…   1         3 0.333 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> salix pol…    20 1     A      global    38.2 BRN7… Plan…   1        22 0.909 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> salix pol…    20 1     A      global    38.2 AXV9… Plan…   0.8      22 0.909 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> salix pol…    20 1     A      global    38.2 AQT8… Plan…   0.3      22 0.909 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> salix pol…    20 1     A      global    38.2 ASM7… Plan…   0.8      22 0.909 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> silene ac…     1 1     A      global    38.2 AUE6… Plan…   0.5       3 0.333 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 8,390 more rows, 2 more variables: level &lt;ord&gt;, max_n_in_sample &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   and abbreviated variable names ¹​sum_abun, ²​n_sample</span></span></span></code></pre></div>
<p>The raw data can be useful for visualizing the trait
distributions.</p>
<p>Use colour and facets to separate between the different traits,
hierarchies and treatments.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">raw_dist_np</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">Site</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">col_palettes</span><span class="op">$</span><span class="va">GrandBudapest1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log(trait value)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span>facets <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Trait</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<p><img src="traitstrap-workflow_files/figure-html/plot-raw-dist-np-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="multivariate-analyses">Multivariate analyses<a class="anchor" aria-label="anchor" href="#multivariate-analyses"></a>
</h2>
<p>While the core functionality of traitstrap was designed with
univariate distributions in mind, it can also be used for multivariate
questions as well using the function
<code><a href="../reference/trait_multivariate_bootstrap.html">trait_multivariate_bootstrap()</a></code>. This function allows users
to supply any appropriate function for analyses of multivariate data,
including those included in popular packages for functional diversity
calculations. Here, we demonstrate how to combine
<code><a href="../reference/trait_multivariate_bootstrap.html">trait_multivariate_bootstrap()</a></code> with the function
<code><a href="https://rdrr.io/pkg/FD/man/dbFD.html" class="external-link">dbFD()</a></code> from the FD package.</p>
<p>We first use the <code><a href="../reference/trait_fill.html">trait_fill()</a></code> function similar to the
univariate case. Note that we are also using the argument
<code>complete_only</code> to specify that we are only interested in
individuals that have all traits and the argument <code>leaf_id</code>,
which tells the function which column contains the unique individual ID.
Also, we are subsetting the data to make it run faster.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FD</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: ade4</span></span>
<span><span class="co">#&gt; Loading required package: ape</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'ape'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     where</span></span>
<span><span class="co">#&gt; Loading required package: geometry</span></span>
<span><span class="co">#&gt; Loading required package: vegan</span></span>
<span><span class="co">#&gt; Loading required package: permute</span></span>
<span><span class="co">#&gt; Loading required package: lattice</span></span>
<span><span class="co">#&gt; This is vegan 2.6-4</span></span>
<span></span>
<span><span class="va">multivariate_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_fill.html">trait_fill</a></span><span class="op">(</span></span>
<span>  comm <span class="op">=</span> <span class="va">community</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># to make the example faster, we'll only use a subset of plots</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>      <span class="va">Site</span> <span class="op">==</span> <span class="st">"1"</span>,</span>
<span>      <span class="va">PlotID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  traits <span class="op">=</span> <span class="va">trait</span>,</span>
<span>  scale_hierarchy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Site"</span>, <span class="st">"PlotID"</span><span class="op">)</span>,</span>
<span>  taxon_col <span class="op">=</span> <span class="st">"Taxon"</span>,</span>
<span>  value_col <span class="op">=</span> <span class="st">"Value"</span>,</span>
<span>  trait_col <span class="op">=</span> <span class="st">"Trait"</span>,</span>
<span>  abundance_col <span class="op">=</span> <span class="st">"Cover"</span>,</span>
<span>  complete_only <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  leaf_id <span class="op">=</span> <span class="st">"ID"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then we are using the <code><a href="../reference/trait_multivariate_bootstrap.html">trait_multivariate_bootstrap()</a></code>
function to do the actual bootstrapping. This function needs the output
from the trait filling as <code>selected_traits</code>, number
bootstrapped of replications <code>nrep</code>, bootstrap size
<code>sample_size</code> and <code>id</code>. The last argument is
<code>fun</code>, that takes any function to apply to the data. In this
case we are using diversity functions from the <code>dbFD</code>
package.</p>
<p>Note that we are using a low number of replicates (nrep) to make it
run faster.</p>
<p>The <code><a href="https://rdrr.io/pkg/FD/man/dbFD.html" class="external-link">dbFD()</a></code> function returns a list as output, and we
need to wrangle the data a bit to get it into a more useful format. We
will extract Rao’s Quadratic Entropy, since that performs well with
bootstrapping.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boot_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_multivariate_bootstrap.html">trait_multivariate_bootstrap</a></span><span class="op">(</span></span>
<span>  selected_traits <span class="op">=</span> <span class="va">multivariate_traits</span>,</span>
<span>  nrep <span class="op">=</span> <span class="fl">20</span>, <span class="co"># number of reps is set low for demo purposes</span></span>
<span>  sample_size <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"ID"</span>,</span>
<span>  fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/FD/man/dbFD.html" class="external-link">dbFD</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">x</span>,</span>
<span>      calc.FRic <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      calc.FDiv <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      calc.CWM <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      stand.x <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      scale.RaoQ <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># data wrangling</span></span>
<span><span class="va">raoq_est</span> <span class="op">&lt;-</span> <span class="va">boot_multi</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>result <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">result</span>, <span class="va">as.data.frame</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre></div>
<p>Let’s plot RaoQ:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">raoq_est</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">RaoQ</span>, fill <span class="op">=</span> <span class="va">PlotID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">col_palettes</span><span class="op">$</span><span class="va">GrandBudapest1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="traitstrap-workflow_files/figure-html/multivariate-plot-1.png" width="576"></p>
<p>Next, we’ll show how we can use a similar method to combine
<code>trait_multivariate_bootstrap</code> with the functions
<code><a href="https://rdrr.io/pkg/TPD/man/TPDs.html" class="external-link">TPDs()</a></code> and <code><a href="https://rdrr.io/pkg/TPD/man/REND.html" class="external-link">REND()</a></code> from the TPD package.</p>
<p>For each replicated site, we convert the distribution into a trait
probability distribution and then derive functional diversity
metrics.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">TPD</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boot_tpd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trait_multivariate_bootstrap.html">trait_multivariate_bootstrap</a></span><span class="op">(</span><span class="va">multivariate_traits</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"ID"</span>,</span>
<span>  nrep <span class="op">=</span> <span class="fl">20</span>, <span class="co"># Note that the number of reps is set low for demo purposes</span></span>
<span>  sample_size <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/TPD/man/TPDs.html" class="external-link">TPDs</a></span><span class="op">(</span></span>
<span>      species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">200</span><span class="op">)</span>,</span>
<span>      traits <span class="op">=</span> <span class="va">x</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/TPD/man/REND.html" class="external-link">REND</a></span><span class="op">(</span>TPDs <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># wrangling data</span></span>
<span><span class="va">tpd</span> <span class="op">&lt;-</span> <span class="va">boot_tpd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>result <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">result</span>, <span class="va">as.data.frame</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="va">species.FRichness</span><span class="op">:</span><span class="va">species.FDivergence</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"metric"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu">str_remove</span><span class="op">(</span><span class="va">metric</span>, <span class="st">"species\\."</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># and make plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tpd</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span>, x <span class="op">=</span> <span class="va">PlotID</span>, fill <span class="op">=</span> <span class="va">PlotID</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    draw_quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">col_palettes</span><span class="op">$</span><span class="va">GrandBudapest1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span>facets <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">metric</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<p><img src="traitstrap-workflow_files/figure-html/multivariate-tpd-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="check-your-data">Check your data<a class="anchor" aria-label="anchor" href="#check-your-data"></a>
</h2>
<p>Traitstrap has a couple of functions to check the data.</p>
<p>The <code>coverage_plot()</code> function shows the trait coverage of
the community for each level. Basically, this function summarizes from
which level the traits are filled, and how much coverage of the
community is reached.</p>
<p>Based on simulations, we recommend to collect traits for at least 80%
of the community cover (Maitner et al. in prep).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># show coverage plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">trait_filling</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">col_palettes</span><span class="op">$</span><span class="va">GrandBudapest1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="traitstrap-workflow_files/figure-html/coverage-plot-1.png" width="576"></p>
<p>Another important information is to know of which taxa traits are
missing. This can be useful if the data sampling is not finished and you
want to know which species should be sampled. The function also tells
you the maximal abundance of each missing species, and gives you useful
information if the missing species are abundant or rare.</p>
<p>Traitstrap has a function <code><a href="../reference/trait_missing.html">trait_missing()</a></code> which gives
you a table with all missing values.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># list missing traits</span></span>
<span><span class="fu"><a href="../reference/trait_missing.html">trait_missing</a></span><span class="op">(</span></span>
<span>  filled_trait <span class="op">=</span> <span class="va">trait_filling</span>,</span>
<span>  comm <span class="op">=</span> <span class="va">community</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 3</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   Taxon [20]</span></span></span>
<span><span class="co">#&gt;    Taxon                      max_abun n_traits</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> alopecurus ovatus               2          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> bistorta vigdis                25          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> calamagrostis neglecta         60          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> cassiope tetragona              5          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> dryas octopetala               20          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> enquistetum scirpoides          2          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> festuca rubra                   1          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> juncus biglumis                 0.5        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> luzula confusa                  5          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> luzula nivalis                  5          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> maitneranthes hieracifolia      0.5        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> oxyria tanyna                   2          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> poa pratensis                   1          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> salix polaris                  43          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> saxifraga hirculus              2          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> saxifraga oppositifolia         2          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> silene acaudis                  1          3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> stelfordaria humifusa           0.5        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> stellaria longipes              0.1        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> trisetum spicatum               3          3</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Richard J. Telford, Aud H. Halbritter, Brian S. Maitner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
